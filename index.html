<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Nexus Transport PR</title>
  <meta name="description" content="Nexus Transport PR — Sistema de servicios sincronizado con Firebase.">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#050505" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="Nexus Transport" />
  <link rel="apple-touch-icon" href="assets/logo.png" />
  <link rel="icon" type="image/png" href="assets/logo.png" />

  <link rel="stylesheet" href="styles.css?v=300"/>

  <!-- Firebase v8 (compatible con app.js) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>

<!-- ================= AUTH SCREEN (Google) ================= -->
<section id="authScreen" class="view view-centered">
  <div class="card card-auth">
    <div class="cardHead">
      <h2>Conectar con Google</h2>
      <div class="hint" id="loginMsg">Inicia sesión para entrar</div>
    </div>
    <button class="btnXL primary" id="btnGoogleLogin">Entrar con Google</button>
    <div class="hr"></div>
    <div class="muted">Nota: el Admin debe invitar tu email antes de entrar.</div>
  </div>
</section>

<!-- ================= PIN SCREEN (después de Google OK) ================= -->
<section id="pinScreen" class="view view-centered hidden">
  <div class="card card-pin">
    <div class="cardHead">
      <h2>Acceso protegido por PIN</h2>
      <div class="hint">Confirma tu PIN o crea uno (primera vez)</div>
    </div>

    <div class="inline2">
      <div class="subcard card">
        <h3 class="h3">Confirmar PIN</h3>
        <label class="lbl">PIN</label>
        <input id="pinInput" type="password" inputmode="numeric" placeholder="••••" />
        <div class="error" id="pinError"></div>
        <button class="btn primary" id="btnPinConfirm">Confirmar PIN</button>
      </div>

      <div class="subcard card">
        <h3 class="h3">Crear PIN (primera vez)</h3>
        <label class="lbl">Nuevo PIN</label>
        <input id="pinNew" type="password" inputmode="numeric" placeholder="Mínimo 4 dígitos"/>
        <label class="lbl">Confirmar PIN</label>
        <input id="pinNew2" type="password" inputmode="numeric" placeholder="Repite el PIN"/>
        <div class="error" id="pinSetError"></div>
        <button class="btn" id="btnPinSet">Guardar PIN</button>
      </div>
    </div>

    <div class="hr"></div>
    <div class="muted">
      Si tu email no está invitado por Admin, no podrás continuar.
    </div>
  </div>
</section>

<!-- ================= APP SHELL ================= -->
<header class="topbar hidden" id="topbar">
  <div class="brand">
    <div class="logo">NT</div>
    <div>
      <div class="brandName" id="brandName">Nexus Transport PR</div>
      <div class="brandSub">
        <span id="whoLine">—</span>
        <span class="dot">•</span>
        <span class="pill" id="rolePill">—</span>
      </div>
    </div>
  </div>

  <nav class="nav" id="navTabs">
    <button class="tab active" data-view="dashboard">Dashboard</button>
    <button class="tab" data-view="driver">Chofer</button>

    <button class="tab" id="tabAdminUsers" data-view="adminUsers">Usuarios</button>
    <button class="tab" id="tabAdminClients" data-view="adminClients">Clientes</button>
    <button class="tab" id="tabAdminServices" data-view="adminServices">Servicios</button>
    <button class="tab" id="tabAdminClose" data-view="adminClose">Cierre</button>
    <button class="tab" id="tabAdminInvoices" data-view="adminInvoices">Facturas</button>
    <button class="tab" id="tabAdminSettings" data-view="adminSettings">Settings</button>
  </nav>

  <div class="actions">
    <button class="btn" id="btnReload">Recargar</button>
    <button class="btn danger" id="btnLogout">Salir</button>
  </div>
</header>

<main class="container hidden" id="app">

  <!-- ================= DASHBOARD ================= -->
  <section class="view active" id="view-dashboard">

    <div class="grid2">
      <div class="card">
        <div class="kpiTitle" id="kpiWeekRange">Semana desde —</div>
        <div class="kpiValue" id="kpiWeekMiles">0.0</div>
        <div class="kpiSub">Millas (semana)</div>
      </div>

      <div class="card">
        <div class="kpiTitle">Servicios</div>
        <div class="kpiValue" id="kpiWeekServices">0</div>
        <div class="kpiSub">Registros (semana)</div>
      </div>

      <div class="card">
        <div class="kpiTitle">Neto Chofer</div>
        <div class="kpiValue" id="kpiWeekDriverNet">$0.00</div>
        <div class="kpiSub">Después % y retención</div>
      </div>

      <div class="card">
        <div class="kpiTitle">Empresa</div>
        <div class="kpiValue" id="kpiWeekCompany">$0.00</div>
        <div class="kpiSub">Participación semanal</div>
      </div>
    </div>

    <div class="card">
      <div class="cardHead">
        <h2>Entrada rápida (Chofer)</h2>
        <div class="hint" id="quickPreview">—</div>
      </div>

      <div class="formGrid">
        <label>Fecha
          <input type="date" id="qsDate"/>
        </label>

        <label>Cliente
          <select id="qsClient"></select>
        </label>

        <label>Millas
          <input id="qsMiles" type="number" step="0.1" inputmode="decimal" placeholder="Ej: 12.5"/>
        </label>

        <label>Nota (opcional)
          <input id="qsNote" placeholder="Ej: peaje, hotel, detalle..."/>
        </label>

        <div class="actions full">
          <button class="btn primary" id="btnQuickSave">Guardar servicio</button>
          <button class="btn" id="btnQuickClear">Limpiar</button>
        </div>

        <div class="muted full">
          Se guarda con anti-duplicado por: mismo chofer + mismo día + mismo cliente + mismas millas.
        </div>
      </div>
    </div>

    <div class="card">
      <div class="cardHead">
        <h2>Últimos servicios (semana)</h2>
        <div class="hint">Admin puede borrar. Chofer solo ve.</div>
      </div>

      <div class="tableWrap">
        <table class="table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Cliente</th>
              <th class="num">Millas</th>
              <th class="num">Bruto</th>
              <th class="num">Neto Chofer</th>
              <th class="num">Acción</th>
            </tr>
          </thead>
          <tbody id="dashRecent"></tbody>
        </table>
      </div>
    </div>

  </section>

  <!-- ================= DRIVER ================= -->
  <section class="view" id="view-driver">
    <div class="card">
      <div class="cardHead">
        <h2>Historial Chofer</h2>
        <div class="hint">Detalle / por semana / por mes + PDF</div>
      </div>

      <div class="formRow">
        <input type="date" id="drvFrom"/>
        <input type="date" id="drvTo"/>
        <select id="drvGroup">
          <option value="none">Detalle</option>
          <option value="week">Por semana</option>
          <option value="month">Por mes</option>
        </select>
        <button class="btn primary" id="btnDrvFilter">Filtrar</button>
        <button class="btn" id="btnDrvPDF">PDF</button>
      </div>

      <div class="tableWrap">
        <table class="table">
          <thead id="drvHead"></thead>
          <tbody id="drvBody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ================= ADMIN VIEWS (igual que tu HTML original) ================= -->
  <!-- Pega aquí EXACTO el bloque de: adminUsers/adminClients/adminServices/adminClose/adminInvoices/adminSettings -->
  <!-- Puedes copiarlo sin cambios desde tu index anterior -->

</main>

<footer class="footer">
  © 2026 Nexus Transport PR
</footer>

<script src="app.js?v=300"></script>
</body>
</html>
