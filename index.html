<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Nexus Transport PR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- ESTILOS -->
  <link rel="stylesheet" href="styles.css">

  <!-- FIREBASE (compat, como Nexus Salon) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>

<!-- =========================
     LOGIN
========================= -->
<section id="view-login" class="view active center">
  <div class="card loginCard">
    <h1>Nexus Transport PR</h1>
    <p class="muted">Acceso seguro</p>

    <button id="btnGoogleLogin" class="btn primary full">Entrar con Google</button>

    <div class="hr"></div>

    <label>PIN</label>
    <input id="pinInput" type="password" placeholder="PIN de acceso">

    <button id="btnPinConfirm" class="btn full">Confirmar PIN</button>

    <p id="loginError" class="error"></p>
  </div>
</section>

<!-- =========================
     TOP BAR
========================= -->
<header id="topbar" class="topbar hidden">
  <div class="brand">
    <div class="logo">NT</div>
    <div>
      <div class="brandName">Nexus Transport PR</div>
      <div class="brandSub">Rol: <span id="userRole">—</span></div>
    </div>
  </div>

  <nav class="nav">
    <button class="tab active" data-view="dashboard">Dashboard</button>
    <button class="tab" data-view="driver" id="tabDriver">Chofer</button>
    <button class="tab" data-view="admin" id="tabAdmin">Admin</button>
    <button id="btnLogout" class="tab danger">Salir</button>
  </nav>
</header>

<!-- =========================
     CONTENEDOR GENERAL
========================= -->
<main class="container hidden" id="appContainer">

  <!-- =========================
       DASHBOARD
  ========================= -->
  <section id="view-dashboard" class="view active">
    <div class="grid2">
      <div class="card">
        <div class="kpiTitle">Millas Semana</div>
        <div class="kpiValue" id="kpiWeekMiles">0</div>
      </div>
      <div class="card">
        <div class="kpiTitle">Servicios Semana</div>
        <div class="kpiValue" id="kpiWeekServices">0</div>
      </div>
      <div class="card">
        <div class="kpiTitle">Neto Chofer</div>
        <div class="kpiValue" id="kpiWeekNet">$0.00</div>
      </div>
      <div class="card">
        <div class="kpiTitle">Ingreso Empresa</div>
        <div class="kpiValue" id="kpiWeekCompany">$0.00</div>
      </div>
    </div>

    <div class="card">
      <div class="cardHead">
        <h2>Servicios Recientes</h2>
      </div>

      <div class="tableWrap">
        <table class="table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Chofer</th>
              <th>Cliente</th>
              <th class="num">Millas</th>
              <th class="num">Bruto</th>
              <th class="num">Neto Chofer</th>
            </tr>
          </thead>
          <tbody id="dashboardServices">
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- =========================
       CHOFER
  ========================= -->
  <section id="view-driver" class="view">
    <div class="card">
      <h2>Registrar Servicio</h2>

      <div class="formGrid">
        <label>
          Cliente
          <select id="drvClient"></select>
        </label>

        <label>
          Millas
          <input type="number" id="drvMiles" min="0" step="0.1">
        </label>

        <label>
          Fecha
          <input type="date" id="drvDate">
        </label>

        <div class="full actions">
          <button id="btnDrvSave" class="btn primary">Guardar Servicio</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Historial del Chofer</h2>

      <div class="filters">
        <label>
          Desde
          <input type="date" id="drvFrom">
        </label>
        <label>
          Hasta
          <input type="date" id="drvTo">
        </label>
        <button id="btnDrvFilter" class="btn">Filtrar</button>
      </div>

      <div class="tableWrap">
        <table class="table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Cliente</th>
              <th class="num">Millas</th>
              <th class="num">Neto</th>
            </tr>
          </thead>
          <tbody id="driverHistory"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- =========================
       ADMIN
  ========================= -->
  <section id="view-admin" class="view">

    <!-- CLIENTES -->
    <div class="card">
      <h2>Clientes</h2>

      <div class="formGrid">
        <label>
          Nombre
          <input id="admClientName">
        </label>

        <label>
          Tarifa por milla
          <input id="admClientRate" type="number" step="0.01">
        </label>

        <label>
          Aplica Connect
          <select id="admClientConnect">
            <option value="no">No</option>
            <option value="yes">Sí</option>
          </select>
        </label>

        <div class="full actions">
          <button id="btnAddClient" class="btn primary">Agregar Cliente</button>
        </div>
      </div>

      <div class="tableWrap">
        <table class="table">
          <thead>
            <tr>
              <th>Cliente</th>
              <th class="num">Tarifa</th>
              <th>Connect</th>
            </tr>
          </thead>
          <tbody id="adminClients"></tbody>
        </table>
      </div>
    </div>

    <!-- CIERRE SEMANAL -->
    <div class="card">
      <h2>Cierre Semanal</h2>

      <div class="filters">
        <label>
          Semana (lunes)
          <input type="date" id="admWeekStart">
        </label>
        <button id="btnBuildWeekly" class="btn">Calcular</button>
        <button id="btnExportPDF" class="btn primary">Exportar PDF</button>
      </div>

      <div id="adminWeeklyReport" class="invoice"></div>
    </div>

  </section>

</main>

<footer class="footer">
  Nexus Transport PR · Sistema Operacional
</footer>

<script src="app.js"></script>
</body>
</html>
