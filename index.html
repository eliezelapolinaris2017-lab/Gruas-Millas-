<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nexus Transport PR</title>

  <link rel="stylesheet" href="styles.css" />

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>

<header class="topbar" id="topbar" style="display:none">
  <div class="brand">
    <div class="logo">NT</div>
    <div>
      <div class="brandName" id="brandName">Nexus Transport PR</div>
      <div class="brandSub">
        <span id="userLine">—</span>
        <span class="muted"> • Rol: </span><b id="roleLine">—</b>
      </div>
    </div>
  </div>

  <nav class="nav">
    <button class="tab active" data-view="dashboard">Dashboard</button>
    <button class="tab" data-view="driver" id="tabDriver">Chofer</button>
    <button class="tab" data-view="admin" id="tabAdmin">Admin</button>
    <button class="tab" id="btnLogout">Salir</button>
  </nav>
</header>

<main class="container">

  <!-- LOGIN -->
  <section id="view-login" class="card">
    <div class="cardHead">
      <h2>Acceso seguro</h2>
      <span class="hint">Google + PIN</span>
    </div>

    <div class="bigActions">
      <button class="btnXL primary" id="btnGoogleLogin">Entrar con Google</button>
    </div>

    <div class="hr"></div>

    <div class="formRow">
      <input id="pinInput" type="password" placeholder="PIN" autocomplete="off">
      <button class="btn" id="btnPinConfirm">Confirmar PIN</button>
    </div>

    <div class="muted" id="loginMsg"></div>
  </section>

  <!-- DASHBOARD -->
  <section id="view-dashboard" class="view">
    <div class="grid2">
      <div class="card">
        <div class="kpiTitle" id="kpiWeekRange">Semana</div>
        <div class="kpiValue" id="kpiWeekNet">$0.00</div>
        <div class="kpiSub">Neto total (según rol)</div>
      </div>
      <div class="card">
        <div class="kpiTitle">Servicios</div>
        <div class="kpiValue" id="kpiWeekServices">0</div>
        <div class="kpiSub">Registrados</div>
      </div>
      <div class="card">
        <div class="kpiTitle">Millas</div>
        <div class="kpiValue" id="kpiWeekMiles">0</div>
        <div class="kpiSub">Totales</div>
      </div>
      <div class="card">
        <div class="kpiTitle">Ingreso por milla (neto)</div>
        <div class="kpiValue" id="kpiRevPerMile">$0.00</div>
        <div class="kpiSub">KPI operativo</div>
      </div>
    </div>

    <div class="card">
      <div class="cardHead">
        <h2>Actividad reciente</h2>
        <span class="hint">últimos 20</span>
      </div>

      <div class="tableWrap">
        <table class="table" id="dashRecentTable">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Chofer</th>
              <th>Cliente</th>
              <th class="num">Millas</th>
              <th class="num">Bruto</th>
              <th class="num">Adj Connect</th>
              <th class="num">Neto chofer</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="dashRecentBody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- DRIVER -->
  <section id="view-driver" class="view">
    <div class="inline2">

      <div class="card">
        <div class="cardHead">
          <h2>Registrar servicio</h2>
          <span class="hint">Chofer solo escribe millas</span>
        </div>

        <form id="driverServiceForm" class="formGrid">
          <label>Fecha
            <input type="date" id="drvDate">
          </label>

          <label>Cliente
            <select id="drvClient"></select>
          </label>

          <label>Millas
            <input type="number" step="0.1" min="0" id="drvMiles" placeholder="0.0">
          </label>

          <label class="full">Nota (opcional)
            <input type="text" id="drvNote" placeholder="Ej: servicio normal">
          </label>

          <div class="actions full">
            <button type="submit" class="btn primary">Guardar</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="cardHead">
          <h2>Mi historial</h2>
          <span class="hint">por rango</span>
        </div>

        <div class="filters">
          <label>Desde
            <input type="date" id="drvFromDate">
          </label>
          <label>Hasta
            <input type="date" id="drvToDate">
          </label>
          <button class="btn" id="btnDrvFilter">Filtrar</button>
        </div>

        <div class="tableWrap">
          <table class="table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Cliente</th>
                <th class="num">Millas</th>
                <th class="num">Neto chofer</th>
              </tr>
            </thead>
            <tbody id="driverHistoryBody"></tbody>
          </table>
        </div>
      </div>

    </div>
  </section>

  <!-- ADMIN -->
  <section id="view-admin" class="view">

    <div class="inline2">

      <div class="card">
        <div class="cardHead">
          <h2>Configuración</h2>
          <span class="hint">persistente</span>
        </div>

        <form id="settingsForm" class="formGrid">
          <label>Empresa / Marca
            <input id="setCompanyName" placeholder="Nexus Transport PR">
          </label>

          <label>Connect % (ej 0.15)
            <input id="setConnectPct" type="number" step="0.01" min="0" max="1">
          </label>

          <label>Empresa % (ej 0.30)
            <input id="setCompanyPct" type="number" step="0.01" min="0" max="1">
          </label>

          <label>Retención chofer % (ej 0.10)
            <input id="setRetentionPct" type="number" step="0.01" min="0" max="1">
          </label>

          <label class="full">Footer reportes
            <input id="setFooter" placeholder="Resumen generado por Nexus Transport PR">
          </label>

          <div class="actions full">
            <button class="btn primary" type="submit">Guardar configuración</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="cardHead">
          <h2>Choferes</h2>
          <span class="hint">por email + PIN</span>
        </div>

        <form id="driverAdminForm" class="formGrid">
          <label>Email Google (chofer)
            <input id="admDrvEmail" placeholder="chofer@email.com">
          </label>

          <label>Nombre (display)
            <input id="admDrvName" placeholder="Nombre Chofer">
          </label>

          <label>PIN (se guarda hasheado)
            <input id="admDrvPin" type="password" placeholder="PIN">
          </label>

          <label>Activo
            <select id="admDrvActive">
              <option value="true">Sí</option>
              <option value="false">No</option>
            </select>
          </label>

          <div class="actions full">
            <button class="btn primary" type="submit">Guardar / Actualizar</button>
          </div>
          <div class="muted full">El chofer entra con su Google + este PIN. Solo verá y escribirá lo suyo.</div>
        </form>

        <div class="hr"></div>

        <div class="tableWrap">
          <table class="table">
            <thead>
              <tr>
                <th>Chofer</th>
                <th>Email</th>
                <th>Activo</th>
              </tr>
            </thead>
            <tbody id="adminDriversBody"></tbody>
          </table>
        </div>

      </div>

    </div>

    <div class="card">
      <div class="cardHead">
        <h2>Clientes (dinámicos)</h2>
        <span class="hint">tarifa por milla</span>
      </div>

      <form id="clientForm" class="formGrid">
        <label>Nombre del cliente
          <input id="admClientName" placeholder="Connect / Dealer / Privado">
        </label>

        <label>Tarifa por milla
          <input id="admClientRate" type="number" step="0.01" min="0" placeholder="0.00">
        </label>

        <label>Aplica Connect (-15%)
          <select id="admClientConnect">
            <option value="false">No</option>
            <option value="true">Sí</option>
          </select>
        </label>

        <label>Activo
          <select id="admClientActive">
            <option value="true">Sí</option>
            <option value="false">No</option>
          </select>
        </label>

        <div class="actions full">
          <button class="btn primary" type="submit">Agregar / Actualizar</button>
        </div>
      </form>

      <div class="hr"></div>

      <div class="tableWrap">
        <table class="table">
          <thead>
            <tr>
              <th>Cliente</th>
              <th class="num">Tarifa</th>
              <th>Connect</th>
              <th>Activo</th>
            </tr>
          </thead>
          <tbody id="adminClientsBody"></tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <div class="cardHead">
        <h2>Cierre semanal</h2>
        <span class="hint">admin</span>
      </div>

      <div class="filters">
        <label>Semana desde (lunes)
          <input type="date" id="admWeekStart">
        </label>

        <button class="btn primary" id="btnBuildWeekly">Generar</button>
        <button class="btn" id="btnExportPDF">Exportar PDF</button>
      </div>

      <div id="adminWeeklyReport" class="invoice"></div>
    </div>

  </section>

</main>

<footer class="footer">Nexus Transport PR · Operación interna</footer>

<script src="app.js"></script>
</body>
</html>
