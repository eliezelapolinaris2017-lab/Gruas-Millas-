<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TowOps MVP ‚Äî Gr√∫as</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">TO</div>
      <div class="brandText">
        <div class="brandName" id="brandName">TowOps MVP</div>
        <div class="brandSub" id="brandSub">Registro ‚Üí Cierre semanal ‚Üí Facturas/Reportes</div>
      </div>
    </div>

    <nav class="nav">
      <button class="tab active" data-view="home">Inicio</button>
      <button class="tab" data-view="service">Registrar</button>
      <button class="tab" data-view="week">Semana</button>
      <button class="tab" data-view="close">Cerrar</button>
      <button class="tab" data-view="settings">Ajustes</button>
    </nav>
  </header>

  <main class="container">

    <!-- INICIO -->
    <section class="view active" id="view-home">
      <div class="grid2">
        <div class="card kpi">
          <div class="kpiTitle">Semana (lunes)</div>
          <div class="kpiValue" id="kpiWeekStart">‚Äî</div>
          <div class="kpiSub">Operaci√≥n en curso</div>
        </div>

        <div class="card kpi">
          <div class="kpiTitle">Total neto semanal</div>
          <div class="kpiValue" id="kpiTotalNet">$0.00</div>
          <div class="kpiSub">Connect -15% aplicado</div>
        </div>

        <div class="card kpi">
          <div class="kpiTitle">Chofer (70% bruto)</div>
          <div class="kpiValue" id="kpiDriverGross">$0.00</div>
          <div class="kpiSub">Antes de retenci√≥n</div>
        </div>

        <div class="card kpi">
          <div class="kpiTitle">Empresa (30%)</div>
          <div class="kpiValue" id="kpiCompanyShare">$0.00</div>
          <div class="kpiSub">Ingresos empresa</div>
        </div>
      </div>

      <div class="card">
        <div class="bigActions">
          <button class="btnXL primary" id="goRegister">‚ûï Registrar servicio</button>
          <button class="btnXL" id="goClose">üìÖ Cerrar semana</button>
        </div>

        <div class="hr"></div>

        <div class="cardHead">
          <h2>√öltimos servicios</h2>
          <span class="muted">Para evitar ‚Äúcazar‚Äù chats: todo cae aqu√≠.</span>
        </div>

        <div class="tableWrap">
          <table class="table" id="recentTable">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Chofer</th>
                <th>Pagador</th>
                <th class="num">Millas</th>
                <th class="num">Monto</th>
                <th>M√©todo</th>
                <th class="num">Gastos</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="hr"></div>

        <div class="rowActions">
          <button class="btn" id="seedDemo">Cargar demo</button>
          <button class="btn danger" id="wipeData">Borrar data (NO settings)</button>
        </div>
      </div>
    </section>

    <!-- REGISTRAR -->
    <section class="view" id="view-service">
      <div class="card">
        <div class="cardHead">
          <h2>Registrar servicio</h2>
          <span class="muted">Entrada r√°pida. Sin c√°lculos. El sistema cuadra.</span>
        </div>

        <form id="serviceForm" class="formGrid">
          <label>
            Fecha
            <input type="date" id="svcDate" required />
          </label>

          <label>
            Chofer
            <select id="svcDriver" required></select>
          </label>

          <label>
            Pagador
            <select id="svcPayer" required></select>
          </label>

          <label>
            M√©todo cobro
            <select id="svcMethod" required>
              <option value="CASH">Cash</option>
              <option value="ATH">ATH M√≥vil</option>
              <option value="CREDITO">Cr√©dito</option>
              <option value="PENDIENTE">Pendiente</option>
            </select>
          </label>

          <label>
            Millas
            <input type="number" id="svcMiles" step="0.1" min="0" required />
          </label>

          <label>
            Monto ($)
            <input type="number" id="svcAmount" step="0.01" min="0" required />
          </label>

          <label>
            Gastos ($)
            <input type="number" id="svcExpense" step="0.01" min="0" value="0" />
          </label>

          <label class="full">
            Nota (opcional)
            <input type="text" id="svcNote" placeholder="Ej: peaje, radiobusto, motor, etc." />
          </label>

          <div class="full actions">
            <button class="btn primary" type="submit">Guardar</button>
            <button class="btn" type="button" id="goHome1">Volver</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="cardHead">
          <h2>Choferes y pagadores (r√°pido)</h2>
          <span class="muted">Para no irte a Ajustes si est√°s en el rush.</span>
        </div>

        <div class="inline2">
          <form id="driverForm" class="formRow">
            <input id="driverName" placeholder="Nombre chofer" required />
            <button class="btn primary" type="submit">A√±adir chofer</button>
          </form>

          <form id="payerForm" class="formRow">
            <input id="payerName" placeholder="Nuevo pagador (Dealer/AAA/etc.)" required />
            <select id="payerType" required>
              <option value="CONNECT">Connect</option>
              <option value="AAA">AAA</option>
              <option value="DEALER">Dealer</option>
              <option value="PRIVADO">Privado</option>
              <option value="OTRO">Otro</option>
            </select>
            <button class="btn primary" type="submit">A√±adir pagador</button>
          </form>
        </div>
      </div>
    </section>

    <!-- SEMANA -->
    <section class="view" id="view-week">
      <div class="card">
        <div class="cardHead">
          <h2>Semana actual</h2>
          <span class="muted">Filtro simple. Nada de laberintos.</span>
        </div>

        <div class="filters">
          <label>Semana (lunes)
            <input type="date" id="weekStart" />
          </label>
          <label>Chofer (opcional)
            <select id="weekDriver"></select>
          </label>
          <button class="btn" id="weekApply">Aplicar</button>
          <button class="btn" id="weekExportCsv">Exportar CSV</button>
        </div>

        <div class="tableWrap">
          <table class="table" id="weekTable">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Chofer</th>
                <th>Pagador</th>
                <th class="num">Millas</th>
                <th class="num">Monto</th>
                <th>M√©todo</th>
                <th class="num">Gastos</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- CERRAR -->
    <section class="view" id="view-close">
      <div class="card">
        <div class="cardHead">
          <h2>Cerrar semana</h2>
          <span class="muted">El sistema aplica: Connect -15% ‚Üí 70/30 ‚Üí Retenci√≥n 10% chofer.</span>
        </div>

        <div class="filters">
          <label>Semana (lunes)
            <input type="date" id="closeWeekStart" />
          </label>
          <label>Chofer
            <select id="closeDriver" required></select>
          </label>
          <button class="btn primary" id="buildClose">Generar cierre</button>
          <button class="btn" id="printClose">Imprimir / Guardar PDF</button>
        </div>

        <div class="hr"></div>

        <div class="formGrid">
          <label>
            Ajuste adicional ($) <span class="hint">(+ suma / - resta)</span>
            <input type="number" id="adjExtra" step="0.01" value="0" />
          </label>
          <label>
            Nota del cierre (opcional)
            <input type="text" id="adjNote" placeholder="Ej: peaje extra, acuerdo especial, etc." />
          </label>
          <div class="full actions">
            <button class="btn" id="saveCloseAdjust">Guardar ajuste</button>
            <span class="muted">Se guarda y no se pierde al refresh.</span>
          </div>
        </div>

        <div class="hr"></div>

        <div id="closeSummary" class="invoice"></div>
      </div>

      <div class="card">
        <div class="cardHead">
          <h2>Factura por pagador (tercero)</h2>
          <span class="muted">Agrupa por Connect/Dealer/AAA para facturar.</span>
        </div>

        <div class="filters">
          <label>Semana (lunes)
            <input type="date" id="invWeekStart" />
          </label>
          <label>Pagador
            <select id="invPayer" required></select>
          </label>
          <button class="btn primary" id="buildInvoice">Crear factura</button>
          <button class="btn" id="printInvoice">Imprimir / Guardar PDF</button>
        </div>

        <div class="hr"></div>

        <div id="invoiceBox" class="invoice"></div>
      </div>
    </section>

    <!-- AJUSTES -->
    <section class="view" id="view-settings">
      <div class="card">
        <div class="cardHead">
          <h2>Ajustes (persistentes)</h2>
          <span class="muted">Se guardan en el dispositivo. No se borran al refresh.</span>
        </div>

        <form id="settingsForm" class="formGrid">
          <label>
            Nombre empresa
            <input id="setCompanyName" />
          </label>

          <label>
            Connect -15% <span class="hint">(0.15)</span>
            <input id="setConnectPct" type="number" step="0.01" min="0" max="1" />
          </label>

          <label>
            Empresa 30% <span class="hint">(0.30)</span>
            <input id="setCompanyPct" type="number" step="0.01" min="0" max="1" />
          </label>

          <label>
            Retenci√≥n chofer 10% <span class="hint">(0.10)</span>
            <input id="setRetentionPct" type="number" step="0.01" min="0" max="1" />
          </label>

          <label class="full">
            Nota / pie de reporte
            <input id="setFooter" placeholder="Opcional" />
          </label>

          <div class="full actions">
            <button class="btn primary" type="submit">Guardar ajustes</button>
            <button class="btn" type="button" id="exportBackup">Exportar Backup (JSON)</button>
            <label class="btn fileBtn">
              Importar Backup
              <input type="file" id="importBackup" accept="application/json" />
            </label>
          </div>
        </form>

        <div class="hr"></div>

        <div class="cardHead">
          <h2>Listas</h2>
          <span class="muted">Mantenimiento b√°sico. Sin Excel.</span>
        </div>

        <div class="inline2">
          <div class="card subcard">
            <h3>Choferes</h3>
            <div class="list" id="driversList"></div>
          </div>

          <div class="card subcard">
            <h3>Pagadores</h3>
            <div class="list" id="payersList"></div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <footer class="footer">
    <span class="muted">TowOps MVP ‚Ä¢ HTML/CSS/JS ‚Ä¢ LocalStorage</span>
  </footer>

  <script src="app.js"></script>
</body>
</html>
