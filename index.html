<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TowOps MVP — Cierre Semanal Grúas</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<header class="topbar">
  <div class="brand">
    <div class="logo">TO</div>
    <div class="brandTxt">
      <div class="brandName" id="brandName">TowOps MVP</div>
      <div class="brandSub">Registro • Cierre semanal • Facturación</div>
    </div>
  </div>

  <nav class="nav">
    <button class="tab active" data-view="dashboard">Inicio</button>
    <button class="tab" data-view="drivers">Choferes</button>
    <button class="tab" data-view="clients">Clientes</button>
    <button class="tab" data-view="services">Servicios</button>
    <button class="tab" data-view="weekly">Cerrar semana</button>
    <button class="tab" data-view="settings">Ajustes</button>
  </nav>
</header>

<main class="container">

  <!-- ================= DASHBOARD ================= -->
  <section class="view active" id="view-dashboard">
    <div class="grid2">
      <div class="card kpi">
        <div class="kpiTitle">Total bruto semana</div>
        <div class="kpiValue" remember="kpiWeekGross">$0.00</div>
        <div class="kpiSub" id="kpiWeekRange">—</div>
      </div>
      <div class="card kpi">
        <div class="kpiTitle">Millas semana</div>
        <div class="kpiValue" id="kpiWeekMiles">0</div>
      </div>
      <div class="card kpi">
        <div class="kpiTitle">Servicios</div>
        <div class="kpiValue" id="kpiWeekServices">0</div>
      </div>
      <div class="card kpi">
        <div class="kpiTitle">Ingreso neto / milla</div>
        <div class="kpiValue" id="kpiRevPerMile">$0.00</div>
      </div>
    </div>

    <div class="card">
      <h2>Registrar servicio</h2>

      <form id="quickServiceForm" class="formGrid">
        <label>Fecha
          <input type="date" id="qsDate" />
        </label>

        <label>Chofer
          <select id="qsDriver"></select>
        </label>

        <label>Cliente
          <select id="qsClient"></select>
        </label>

        <label>Tipo
          <select id="qsType">
            <option value="CONNECT">CONNECT</option>
            <option value="AAA">AAA</option>
            <option value="DEALER">DEALER</option>
            <option value="PRIVADO">PRIVADO</option>
            <option value="OTRO">OTRO</option>
          </select>
        </label>

        <label>Millas
          <input type="number" id="qsMiles" step="0.1" />
        </label>

        <label>Monto $
          <input type="number" id="qsAmount" step="0.01" />
        </label>

        <label>Método pago
          <select id="qsPayMethod">
            <option value="CASH">CASH</option>
            <option value="ATH">ATH</option>
            <option value="CREDITO">CREDITO</option>
            <option value="PENDIENTE">PENDIENTE</option>
          </select>
        </label>

        <label>Gastos
          <input type="number" id="qsExpenses" step="0.01" />
        </label>

        <label class="full">Nota
          <input type="text" id="qsNote" placeholder="Opcional" />
        </label>

        <div class="full actions">
          <button class="btn primary" type="submit">Guardar</button>
          <button class="btn" type="button" id="seedDemo">Cargar demo</button>
        </div>
      </form>

      <hr />

      <h3>Últimos servicios</h3>
      <div class="tableWrap">
        <table class="table" id="dashRecentTable">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Chofer</th>
              <th>Cliente</th>
              <th>Tipo</th>
              <th class="num">Millas</th>
              <th class="num">Monto</th>
              <th class="num">Gastos</th>
              <th>Pago</th>
              <th class="num">Connect -15%</th>
              <th class="num">Neto servicio</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

    </div>
  </section>

  <!-- ================= CHOFERES ================= -->
  <section class="view" id="view-drivers">
    <div class="card">
      <h2>Choferes</h2>

      <form id="driverForm" class="formRow">
        <input id="driverName" placeholder="Nombre chofer" />
        <button class="btn primary" type="submit">Añadir</button>
      </form>

      <div class="tableWrap">
        <table class="table" id="driversTable">
          <thead>
            <tr>
              <th>Nombre</th>
              <th class="num"></th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

    </div>
  </section>

  <!-- ================= CLIENTES ================= -->
  <section class="view" id="view-clients">
    <div class="card">
      <h2>Clientes</h2>

      <form id="clientForm" class="formRow">
        <input id="clientName" placeholder="Nombre cliente" />
        <input id="clientEmail" placeholder="Email (opcional)" />
        <button class="btn primary" type="submit">Añadir</button>
      </form>

      <div class="tableWrap">
        <table class="table" id="clientsTable">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Email</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

    </div>
  </section>

  <!-- ================= SERVICIOS ================= -->
  <section class="view" id="view-services">
    <div class="card">
      <h2>Servicios</h2>

      <div class="actions">
        <button class="btn" id="svcExportCsv" type="button">Exportar CSV</button>
      </div>

      <div class="tableWrap">
        <table class="table" id="servicesTable">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Chofer</th>
              <th>Cliente</th>
              <th>Tipo</th>
              <th class="num">Millas</th>
              <th class="num">Monto</th>
              <th class="num">Gastos</th>
              <th>Pago</th>
              <th class="num">Connect</th>
              <th class="num">Neto</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

    </div>
  </section>

  <!-- ================= CIERRE SEMANAL ================= -->
  <section class="view" id="view-weekly">

    <div class="card">
      <h2>Cerrar semana (Chofer)</h2>

      <div class="filters">
        <label>Semana (lunes)
          <input type="date" id="wkStart" />
        </label>

        <label>Chofer
          <select id="wkDriver"></select>
        </label>
      </div>

      <h3>Ajustes manuales (opcionales)</h3>
      <div class="filters">
        <input id="wkAdjGastos" placeholder="Gastos" type="number" step="0.01" />
        <input id="wkAdjPeajes" placeholder="Peajes" type="number" step="0.01" />
        <input id="wkAdjEnBolsa" placeholder="En bolsa" type="number" step="0.01" />
        <input id="wkAdjUsoCash" placeholder="Uso cash" type="number" step="0.01" />
        <input id="wkAdjSeDebe" placeholder="Se le debe (+/-)" type="number" step="0.01" />
      </div>

      <div class="actions">
        <button class="btn primary" id="wkBuild" type="button">Calcular cierre</button>
        <button class="btn" id="wkPrint" type="button">PDF (jsPDF)</button>
      </div>

      <div id="weeklySummary" class="invoice"></div>
    </div>

    <div class="card">
      <h2>Factura por cliente</h2>

      <div class="filters">
        <label>Semana (lunes)
          <input type="date" id="invWeekStart" />
        </label>

        <label>Cliente
          <select id="invClient"></select>
        </label>
      </div>

      <div class="actions">
        <button class="btn primary" id="invBuild" type="button">Generar vista factura</button>
        <button class="btn" id="invPrint" type="button">PDF (jsPDF)</button>
      </div>

      <div id="invoiceClient" class="invoice"></div>
    </div>

  </section>

  <!-- ================= SETTINGS ================= -->
  <section class="view" id="view-settings">
    <div class="card">
      <h2>Ajustes</h2>

      <form id="settingsForm" class="formGrid">
        <label>Nombre empresa
          <input id="setCompanyName" />
        </label>

        <label>Connect (-15% = 0.15)
          <input id="setConnectPct" type="number" step="0.01" />
        </label>

        <label>% Empresa (0.30 = 30%)
          <input id="setCompanyPct" type="number" step="0.01" />
        </label>

        <label>Retención chofer (0.10 = 10%)
          <input id="setRetentionPct" type="number" step="0.01" />
        </label>

        <label class="full">Pie de documento
          <input id="setFooter" />
        </label>

        <div class="full actions">
          <button class="btn primary" type="submit">Guardar ajustes</button>
          <button class="btn danger" type="button" id="wipeAll">Borrar datos</button>
        </div>
      </form>
    </div>
  </section>

</main>

<footer class="footer">
  <span class="muted">TowOps MVP • LocalStorage • PDF con jsPDF</span>
</footer>

<!-- jsPDF (DEBE ir antes de app.js) -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<!-- App -->
<script src="app.js"></script>

</body>
</html>
